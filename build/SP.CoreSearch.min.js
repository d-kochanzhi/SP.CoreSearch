!function(){"use strict";ExecuteOrDelayUntilScriptLoaded(function(){SP.CoreSearch||(Type.registerNamespace("SP.CoreSearch"),SP.CoreSearch.Settings=function(){this.Culture="1049",this.EnableQueryRules=!1,this.TrimDuplicates=!1,this.SelectProperties=["Title"],this.Querytext="",this.QueryTemplate="{searchterms}",this.StartRow=0,this.RowLimit=10,this.SortList=[],this.RefinementFilters=[],this.Refiners="",this.SourceId="",this.RankingModelId=""},SP.CoreSearch.Settings.prototype.PrepareQuery=function(){var e={__metadata:{type:"Microsoft.Office.Server.Search.REST.SearchRequest"},Culture:this.Culture,UILanguage:this.Culture,EnableQueryRules:this.EnableQueryRules,TrimDuplicates:this.TrimDuplicates,SelectProperties:{results:this.SelectProperties},Querytext:this.Querytext,QueryTemplate:this.QueryTemplate,StartRow:this.StartRow,RowLimit:this.RowLimit,EnableSorting:0<this.SortList.length,SortList:{results:this.SortList},RefinementFilters:{results:this.RefinementFilters},Refiners:this.Refiners,SourceId:this.SourceId,RankingModelId:this.RankingModelId};return this.SourceId||delete e.SourceId,this.RankingModelId||delete e.RankingModelId,e},SP.CoreSearch.Settings.prototype.ApplyRefiner=function(e,t,r){var s=this;return this.__refiners=this.__refiners||{},this.__refiners[e]||(this.__refiners[e]=[]),t&&(0<=this.__refiners[e].indexOf(t)?this.__refiners[e].splice(this.__refiners[e].indexOf(t),1):this.__refiners[e].push(t)),r&&(0<=this.__refiners[e].indexOf(r)?this.__refiners[e].splice(this.__refiners[e].indexOf(r),1):this.__refiners[e].push(r)),this.__refiners[e].length||delete this.__refiners[e],s.RefinementFilters.splice(0,s.RefinementFilters.length),Object.getOwnPropertyNames(this.__refiners).forEach(function(e){var t="";s.__refiners[e].forEach(function(e){-1<e.indexOf("??")?t+=",{0}".format(e):t+=',equals("{0}")'.format(e)}),s.RefinementFilters.push("{0}:or(".format(e)+t.substring(1)+")")}),this.__refiners},SP.CoreSearch.Settings.registerClass("SP.CoreSearch.Settings"),SP.CoreSearch.Settings.Instance=new SP.CoreSearch.Settings,SP.CoreSearch.SearchEngine=function(){this.__digest=null,this.__settings=new SP.CoreSearch.Settings},SP.CoreSearch.SearchEngine.prototype.Request=function(e,t,r){var o=this;return null!==e&&e instanceof SP.CoreSearch.Settings?this.__settings=e:this.__settings=new SP.CoreSearch.Settings,r&&(this.__settings.RowLimit=r),t&&(this.__settings.StartRow=(t-1)*this.__settings.RowLimit),new Promise(function(i,n){try{o.__requestDigest().then(function(e){var t="/_api/search/postquery?_="+(new Date).getTime(),r=JSON.stringify({request:o.__settings.PrepareQuery()}),s={accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":e.FormDigestValue};o.__httpPost(t,r,s).then(function(e){i(o.__prepareSearchResults(e))},function(e){window.console&&console.log&&console.log(e),n()})})}catch(e){n(e)}})},SP.CoreSearch.SearchEngine.registerClass("SP.CoreSearch.SearchEngine"),SP.CoreSearch.SearchEngine.Instance=new SP.CoreSearch.SearchEngine,SP.CoreSearch.SearchEngine.prototype.__httpPost=function(e,i,n){return new Promise(function(t,r){var s="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");s.open("POST",e,!0),n&&Object.getOwnPropertyNames(n).forEach(function(e){s.setRequestHeader(e,n[e])}),s.responseType="text",s.onload=function(){if(200==s.status)t(JSON.parse(s.response));else{var e=new Error(s.statusText);e.code=s.status,r(e)}},s.onerror=function(){r(new Error("Network Error"))},s.send(i)})},SP.CoreSearch.SearchEngine.prototype.__requestDigest=function(){var s=this;return new Promise(function(t,r){if(s.__digest&&s.__digest.Date>new Date)t(s.__digest);else{var e="/_api/contextinfo?_="+(new Date).getTime();s.__httpPost(e,null,{accept:"application/json;odata=verbose"}).then(function(e){s.__digest=e.d.GetContextWebInformation,s.__digest.Date=new Date((new Date).getTime()+1e3*s.__digest.FormDigestTimeoutSeconds),t(s.__digest)},function(e){r(e)})}})},SP.CoreSearch.SearchEngine.prototype.__prepareSearchResults=function(e){var t={TotalPages:0,TotalRows:0,CurrentPage:0,PrimaryResults:[],RefinementResults:[]};if(e&&"object"==typeof e&&e.d.postquery.PrimaryQueryResult){var r=e.d.postquery.PrimaryQueryResult.RelevantResults;r&&(t.TotalRows=r.TotalRows,t.PrimaryResults=this.__convertPrimaryResultsToObjectArray(r.Table.Rows.results),t.TotalPages=Math.ceil(t.TotalRows/this.__settings.RowLimit),t.CurrentPage=Math.ceil(this.__settings.StartRow/this.__settings.RowLimit)+1);var s=e.d.postquery.PrimaryQueryResult.RefinementResults;s&&(t.RefinementResults=this.__convertRefinersResultsToObjectArray(s.Refiners.results))}return t},SP.CoreSearch.SearchEngine.prototype.__convertPrimaryResultsToObjectArray=function(e){if(!e||0===e.length)return[];for(var t=[],r=0;r<e.length;r++)t.push(this.__convertPrimaryResultsItemToObject(e[r]));return t},SP.CoreSearch.SearchEngine.prototype.__convertPrimaryResultsItemToObject=function(e){for(var t={},r=e.Cells.results,s=0;s<r.length;s++){var i=r[s];if(i.Value&&("string"!=typeof i.Value||i.Value.trim())){var n=i.Value;switch(i.ValueType){case"Edm.Double":n=parseFloat(n);break;case"Edm.Int64":n=parseInt(n);break;case"Edm.Boolean":n="true"===n}t[i.Key]=n}}return t},SP.CoreSearch.SearchEngine.prototype.__convertRefinersResultsToObjectArray=function(e){if(!e||0===e.length)return[];for(var t=[],r=0;r<e.length;r++)t.push(this.__convertRefinersResultsItemToObject(e[r]));return t},SP.CoreSearch.SearchEngine.prototype.__convertRefinersResultsItemToObject=function(e){var t={};return t.Name=e.Name,t.Items=e.Entries.results,t},"undefined"!=typeof Sys&&Sys&&Sys.Application&&Sys.Application.notifyScriptLoaded(),NotifyScriptLoadedAndExecuteWaitingJobs("SP.CoreSearch"))},"sp.init.js")}();